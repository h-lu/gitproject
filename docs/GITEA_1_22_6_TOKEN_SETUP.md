# Gitea 1.22.6 Token å¿«é€Ÿè®¾ç½®æŒ‡å—

**é’ˆå¯¹ç‰ˆæœ¬**: Gitea 1.22.6  
**é—®é¢˜**: Token ç¼ºå°‘ `read:user` æƒé™å¯¼è‡´ HTTP 403 é”™è¯¯

## ğŸ“‹ å¿«é€Ÿæ£€æŸ¥æ¸…å•

- [ ] ç¡®è®¤ Gitea ç‰ˆæœ¬æ˜¯ 1.22.6ï¼ˆè®¿é—® http://49.234.193.192:3000ï¼Œå³ä¸‹è§’æ˜¾ç¤ºç‰ˆæœ¬å·ï¼‰
- [ ] äº†è§£ `read:api` åœ¨æ­¤ç‰ˆæœ¬ä¸­ä¸å­˜åœ¨ï¼ˆè¿™æ˜¯æ­£å¸¸çš„ï¼‰
- [ ] å·²å‡†å¤‡å¥½åˆ›å»ºæ–°çš„ Token

## ğŸš€ 5 åˆ†é’Ÿå¿«é€Ÿè®¾ç½®

### ç¬¬ 1 æ­¥ï¼šåˆ›å»ºæ–° Token

è®¿é—®ï¼š**http://49.234.193.192:3000/user/settings/applications/tokens**

ç‚¹å‡» **"ç”Ÿæˆæ–°ä»¤ç‰Œ"** æˆ– **"Generate New Token"**

### ç¬¬ 2 æ­¥ï¼šå¡«å†™ä»¤ç‰Œä¿¡æ¯

- **ä»¤ç‰Œåç§°**: `autograde-system-token`
- **æƒé™èŒƒå›´**: å…¨éƒ¨å‹¾é€‰ï¼ˆè§ä¸‹è¡¨ï¼‰

### ç¬¬ 3 æ­¥ï¼šé€‰æ‹©æƒé™ï¼ˆå¤åˆ¶ç²˜è´´æ£€æŸ¥åˆ—è¡¨ï¼‰

```
è¯»æƒé™:
â˜‘ read:user
â˜‘ read:repository
â˜‘ read:organization

å†™æƒé™:
â˜‘ write:user
â˜‘ write:repository
â˜‘ write:organization
â˜‘ write:issue
â˜‘ write:admin
```

**âš ï¸ é‡è¦**: `read:api` **ä¸å­˜åœ¨** äº Gitea 1.22.6 - è¿™æ˜¯æ­£å¸¸çš„ï¼Œä¸è¦æ‰¾å®ƒï¼

### ç¬¬ 4 æ­¥ï¼šç”Ÿæˆ Token

1. ç‚¹å‡» **"ç”Ÿæˆä»¤ç‰Œ"** / **"Generate Token"**
2. å¤åˆ¶æ˜¾ç¤ºçš„ Tokenï¼ˆè¿™æ˜¯å”¯ä¸€ä¸€æ¬¡çœ‹åˆ°å®Œæ•´çš„ Tokenï¼ï¼‰
3. ä¿å­˜åˆ°å®‰å…¨åœ°æ–¹

### ç¬¬ 5 æ­¥ï¼šè®¾ç½®ç¯å¢ƒå˜é‡

```bash
# åœ¨å½“å‰ shell ä¸­å¯¼å‡º Token
export GITEA_ADMIN_TOKEN=æ–°tokenå®Œæ•´å€¼

# ï¼ˆå¯é€‰ï¼‰å†™å…¥ shell é…ç½®ä»¥é•¿æœŸç”Ÿæ•ˆ
echo 'export GITEA_ADMIN_TOKEN=æ–°tokenå®Œæ•´å€¼' >> ~/.bashrc
source ~/.bashrc
```

### ç¬¬ 6 æ­¥ï¼šéªŒè¯

```bash
echo $GITEA_ADMIN_TOKEN
./scripts/test_token_permissions.sh

# é¢„æœŸè¾“å‡º: æ‰€æœ‰é¡¹éƒ½æ˜¯ âœ…
```

## ğŸ“Š Gitea 1.22.6 æƒé™å¯¹ç…§è¡¨

| æƒé™èŒƒå›´ | åŠŸèƒ½æè¿° | ç”¨é€” |
|---------|--------|------|
| **read:user** â­ | API åŸºç¡€è®¤è¯ | å¿…éœ€ - æ— æ­¤æƒé™ä¼šå¯¼è‡´ HTTP 403 |
| **read:repository** | åˆ—å‡ºå’Œè¯»å–ä»“åº“ | å¿…éœ€ |
| **read:organization** | è¯»ç»„ç»‡ä¿¡æ¯ | æ¨è |
| **write:user** | ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ | å¯é€‰ |
| **write:repository** | æ¨é€ä»£ç ã€ç®¡ç†ä»“åº“ | å¿…éœ€ |
| **write:organization** | ç®¡ç†ç»„ç»‡ | å¿…éœ€ |
| **write:issue** ğŸ”‘ | åˆ›å»º Issue å’Œ PR è¯„è®º | æœ€å…³é”®ï¼(è¯„åˆ†ç³»ç»Ÿæ ¸å¿ƒ) |
| **write:admin** | ç®¡ç†å‘˜æƒé™ | æ¨è |

## â“ å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆæ‰¾ä¸åˆ° read:apiï¼Ÿ
**A**: Gitea 1.22.6 ä¸æä¾›æ­¤æƒé™ã€‚è¿™ä¸æ˜¯é—®é¢˜ï¼Œå¯ä»¥è·³è¿‡ã€‚

### Q: Token åˆ›å»ºåèƒ½ä¿®æ”¹æƒé™å—ï¼Ÿ
**A**: ä¸èƒ½ã€‚æƒé™åœ¨åˆ›å»ºæ—¶å›ºå®šï¼Œæ— æ³•ä¿®æ”¹ã€‚å¦‚æœé€‰é”™äº†ï¼Œå¿…é¡»åˆ é™¤ä»¤ç‰Œå¹¶åˆ›å»ºæ–°çš„ã€‚

### Q: æœ€å°æƒé™æ˜¯ä»€ä¹ˆï¼Ÿ
**A**: å¦‚æœåªæƒ³è¦æœ€å°æƒé™ï¼Œå‹¾é€‰ï¼š
- â˜‘ read:user
- â˜‘ read:repository  
- â˜‘ write:repository
- â˜‘ write:issue
- â˜‘ write:organization

### Q: æµ‹è¯•æ—¶æ˜¾ç¤º HTTP 404 æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ
**A**: è¿™é€šå¸¸æ˜¯æ­£å¸¸çš„ï¼ˆæŸäº› API ç«¯ç‚¹åœ¨æ­¤ç‰ˆæœ¬ä¸­ä¸å­˜åœ¨ï¼‰ï¼Œåªè¦ `read:user` æ˜¾ç¤º âœ… å°±å¯ä»¥ã€‚

### Q: è¿˜æ˜¯æ”¶åˆ° HTTP 403ï¼Ÿ
**A**: 
1. ç¡®è®¤å½“å‰ shell ä¸­çš„ `GITEA_ADMIN_TOKEN` å·²æ›´æ–°
2. å¦‚æœå†™å…¥ shell é…ç½®ï¼Œè¯·æ‰§è¡Œ `source ~/.bashrc`ï¼ˆæˆ–å¯¹åº”æ–‡ä»¶ï¼‰
3. æ£€æŸ¥æ–° Token æ˜¯å¦åŒ…å« `read:user` æƒé™

## ğŸ”— ç›¸å…³èµ„æº

- **Token ç®¡ç†**: http://49.234.193.192:3000/user/settings/applications/tokens
- **API æ–‡æ¡£**: http://49.234.193.192:3000/api/swagger  
- **å®Œæ•´æŒ‡å—**: docs/TOKEN_PERMISSIONS_GUIDE.md
- **æƒé™æµ‹è¯•**: ./scripts/test_token_permissions.sh

## âœ… å®Œæˆæ ‡å¿—

å½“ä½ çœ‹åˆ°ä»¥ä¸‹è¾“å‡ºæ—¶ï¼Œè¯´æ˜ Token é…ç½®æˆåŠŸï¼š

```
ğŸ“– æµ‹è¯•è¯»æƒé™:
âœ… read:user - è·å–ç”¨æˆ·ä¿¡æ¯
âœ… read:repository - è¯»ä»“åº“ä¿¡æ¯
âœ… read:organization - è¯»ç»„ç»‡ä¿¡æ¯

âœï¸  æµ‹è¯•å†™æƒé™:
âœ… write:repository - åˆ—å‡ºä»“åº“
âœ… write:organization - åˆ—å‡ºç»„ç»‡
âœ… write:issue - æµ‹è¯• Issue æƒé™
```

## ğŸ¯ ä¸‹ä¸€æ­¥

Token éªŒè¯æˆåŠŸåï¼š

1. è¿è¡Œ `./check_config.sh` è¿›è¡Œå®Œæ•´é…ç½®æ£€æŸ¥
2. å­¦ç”Ÿä»“åº“ push åˆ° `main`ï¼Œç¡®è®¤ Workflow æˆåŠŸè¿è¡Œå¹¶åœ¨ `hw1-metadata` ä¸­ç”Ÿæˆ JSON
3. è¿è¡Œ `python scripts/collect_grades.py --metadata-repo course-test/hw1-metadata` éªŒè¯æ•™å¸ˆèƒ½è¯»å–å…ƒæ•°æ®

---

**æœ€åæ›´æ–°**: é’ˆå¯¹ Gitea 1.22.6  
**é—®é¢˜è§£å†³**: ç§»é™¤äº†å¯¹ read:api çš„å¼•ç”¨  
**éªŒè¯çŠ¶æ€**: âœ… å·²æµ‹è¯•å¹¶ç¡®è®¤å·¥ä½œæ­£å¸¸

