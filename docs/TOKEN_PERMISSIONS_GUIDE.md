# Gitea Token æƒé™é…ç½®æŒ‡å—

## é—®é¢˜ç—‡çŠ¶

å½“æµ‹è¯• API è¿æ¥æ—¶ï¼Œæ”¶åˆ°ä»¥ä¸‹é”™è¯¯ï¼š

```
âŒ API Token æ— æ•ˆæˆ–æƒé™ä¸è¶³ (HTTP 403)
å“åº”: token does not have at least one of required scope(s): [read:user]
```

æˆ–è¿è¡Œ `./scripts/test_token_permissions.sh` æ˜¾ç¤ºï¼š

```
âŒ read:user - è·å–ç”¨æˆ·ä¿¡æ¯ (HTTP 403)
   é”™è¯¯: token does not have at least one of required scope(s): [read:user]
```

## æ ¹æœ¬åŸå› 

Gitea ä¸­çš„æƒé™æ˜¯åˆ†å±‚çš„ï¼š

- **read:*** æƒé™ - ç”¨äºè¯»å–/è·å–ä¿¡æ¯
- **write:*** æƒé™ - ç”¨äºä¿®æ”¹/åˆ›å»ºä¿¡æ¯

å³ä½¿ä½ æœ‰å¾ˆå¤š `write:*` æƒé™ï¼Œä¹Ÿå¿…é¡»æœ‰å¯¹åº”çš„ `read:*` æƒé™æ‰èƒ½è¿›è¡ŒåŸºæœ¬çš„ API æ“ä½œã€‚

### å¸¸è§è¯¯è§£

âŒ **é”™è¯¯è®¤çŸ¥**ï¼šæ‹¥æœ‰ `write:admin` æƒé™å°±èƒ½åšæ‰€æœ‰äº‹æƒ…
âœ… **æ­£ç¡®è®¤çŸ¥**ï¼šéœ€è¦ `read:user` ä½œä¸ºåŸºç¡€æƒé™ï¼ŒåŠ ä¸Šå„ç§ `write:*` æƒé™

## è§£å†³æ–¹æ¡ˆ

### æ­¥éª¤ 1ï¼šè®¿é—® Token ç®¡ç†ç•Œé¢

ç™»å½• Gitea å¹¶è®¿é—®ï¼š
```
http://49.234.193.192:3000/user/settings/applications/tokens
```

### æ­¥éª¤ 2ï¼šåˆ é™¤æ—§ Tokenï¼ˆå¯é€‰ï¼‰

å¦‚æœå·²æœ‰çš„ Token æƒé™ä¸å¯¹ï¼Œå¯ä»¥å°†å…¶åˆ é™¤ã€‚

### æ­¥éª¤ 3ï¼šåˆ›å»ºæ–° Token

ç‚¹å‡»"ç”Ÿæˆæ–°ä»¤ç‰Œ"æˆ–"Generate New Token"

**Token åç§°**ï¼š
```
autograde-system-token
```

**å¿…é€‰æƒé™èŒƒå›´**ï¼ˆå…¨éƒ¨å‹¾é€‰ï¼‰ï¼š

#### è¯»æƒé™ï¼ˆå¿…éœ€ï¼‰
- â˜‘ **read:user** â† æœ€é‡è¦ï¼åŸºç¡€æƒé™
- â˜‘ **read:repository** - è¯»ä»“åº“ä¿¡æ¯
- â˜‘ **read:organization** - è¯»ç»„ç»‡ä¿¡æ¯

> **æ³¨æ„**ï¼šGitea 1.22.6 ä¸æä¾› `read:api` æƒé™èŒƒå›´ã€‚å¦‚æœä½ çœ‹ä¸åˆ°è¯¥é€‰é¡¹ï¼Œè¿™æ˜¯æ­£å¸¸çš„ã€‚

#### å†™æƒé™ï¼ˆå¿…éœ€ï¼‰
- â˜‘ **write:user** - ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯
- â˜‘ **write:repository** - ä»“åº“å†™æƒé™ï¼ˆæ¨é€ä»£ç ç­‰ï¼‰
- â˜‘ **write:organization** - ç»„ç»‡ç®¡ç†æƒé™
- â˜‘ **write:issue** - åˆ›å»º/ä¿®æ”¹ Issue å’Œ PR è¯„è®º

#### å…¶ä»–æƒé™ï¼ˆæ¨èï¼‰
- â˜‘ **write:admin** - ç®¡ç†å‘˜æƒé™ï¼ˆç”¨äºç»Ÿè®¡æŸ¥è¯¢ï¼‰

### æ­¥éª¤ 4ï¼šç”Ÿæˆå¹¶å¤åˆ¶ Token

1. ç‚¹å‡»"ç”Ÿæˆä»¤ç‰Œ"æˆ–"Generate Token"
2. å¤åˆ¶æ˜¾ç¤ºçš„ Token å€¼
3. **ä¿å­˜åˆ°å®‰å…¨åœ°æ–¹**ï¼ˆè¿™æ˜¯å”¯ä¸€ä¸€æ¬¡æ˜¾ç¤ºè¯¥ Tokenï¼‰

### æ­¥éª¤ 5ï¼šè®¾ç½®ç¯å¢ƒå˜é‡

åœ¨å½“å‰ shell ä¸­å¯¼å‡ºæ–°çš„ Tokenï¼ˆæˆ–å†™å…¥ `~/.bashrc` / `~/.zshrc`ï¼‰ï¼š

```bash
export GITEA_ADMIN_TOKEN=æ–°çš„å®Œæ•´tokenå€¼
```

è‹¥æƒ³æ°¸ä¹…ç”Ÿæ•ˆï¼Œå¯è¿è¡Œï¼š

```bash
echo 'export GITEA_ADMIN_TOKEN=æ–°çš„å®Œæ•´tokenå€¼' >> ~/.bashrc
source ~/.bashrc
```

### æ­¥éª¤ 6ï¼šéªŒè¯é…ç½®

```bash
echo $GITEA_ADMIN_TOKEN
```

### æ­¥éª¤ 7ï¼šæµ‹è¯•æ–° Token

```bash
# æµ‹è¯•æƒé™
./scripts/test_token_permissions.sh

# åº”è¯¥çœ‹åˆ°æ‰€æœ‰é¡¹éƒ½æ˜¯ âœ…
```

é¢„æœŸè¾“å‡ºï¼š
```
ğŸ“– æµ‹è¯•è¯»æƒé™:
âœ… read:user - è·å–ç”¨æˆ·ä¿¡æ¯
âœ… read:repository - è¯»ä»“åº“ä¿¡æ¯
âœ… read:organization - è¯»ç»„ç»‡ä¿¡æ¯

âœï¸  æµ‹è¯•å†™æƒé™:
âœ… write:user - ...
âœ… write:repository - ...
âœ… write:organization - ...
âœ… write:issue - ...
```

## æƒé™è¯¦ç»†è¯´æ˜

| æƒé™èŒƒå›´ | åŠŸèƒ½ | è‡ªåŠ¨è¯„åˆ†ç³»ç»Ÿéœ€è¦ |
|---------|------|-----------------|
| **read:user** | è¯»ç”¨æˆ·ä¿¡æ¯ã€API è®¤è¯ | âœ… å¿…éœ€ |
| **read:repository** | åˆ—å‡ºä»“åº“ã€è¯»ä»“åº“ä¿¡æ¯ | âœ… å¿…éœ€ |
| **read:organization** | åˆ—å‡ºç»„ç»‡ã€è¯»æˆå‘˜ | âœ… éœ€è¦ |
| **write:user** | ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ | âŒ å¯é€‰ |
| **write:repository** | æ¨é€ä»£ç ã€åˆ›å»ºä»“åº“ | âœ… å¿…éœ€ |
| **write:organization** | ç®¡ç†ç»„ç»‡æˆå‘˜ | âœ… éœ€è¦ |
| **write:issue** | **åˆ›å»º Issue / PR è¯„è®ºï¼ˆå¯é€‰ï¼‰** | âœ… æ¨èç”¨äºæ‰‹åŠ¨æ¨é€è¯„åˆ†é€šçŸ¥ |
| **write:admin** | æœåŠ¡å™¨ç®¡ç†æƒé™ | âš ï¸ æ¨è |

**æ³¨æ„ï¼ˆGitea 1.22.6ï¼‰**ï¼š`read:api` æƒé™åœ¨ Gitea 1.22.6 ä¸­ä¸å­˜åœ¨ã€‚å¦‚æœä½ çœ‹ä¸åˆ°è¿™ä¸ªæƒé™é€‰é¡¹ï¼Œè¿™æ˜¯æ­£å¸¸çš„ã€‚

## æœ€å°æƒé™é…ç½®ï¼ˆGitea 1.22.6ï¼‰

å¦‚æœæƒ³ä½¿ç”¨æœ€å°æƒé™é›†åˆï¼ˆä»…å‹¾é€‰å¿…éœ€é¡¹ï¼‰ï¼š

```
â˜‘ read:user              (API åŸºç¡€è®¤è¯)
â˜‘ read:repository        (åˆ—å‡ºå’Œè¯»å–ä»“åº“)
â˜‘ write:repository       (ä»“åº“æ“ä½œ)
â˜‘ write:organization     (ç»„ç»‡çº§æ“ä½œ)
```

**ä¸ºä»€ä¹ˆæ˜¯è¿™ä¸ªé…ç½®**ï¼š
- `read:user` æ˜¯åŸºç¡€æƒé™ï¼Œæ²¡æœ‰å®ƒæ— æ³•è¿›è¡Œä»»ä½• API æ“ä½œ
- `read:repository` ç”¨äºåˆ—å‡ºå’Œå…‹éš†ä»“åº“
- `write:repository` ç”¨äºæ¨é€ä»£ç å’Œç®¡ç†ä»“åº“
- `write:issue` æ˜¯å‘é€ PR è¯„è®ºçš„å¿…éœ€æƒé™ï¼ˆè‡ªåŠ¨è¯„åˆ†ç³»ç»Ÿæ ¸å¿ƒåŠŸèƒ½ï¼‰
- `write:organization` ç”¨äºç»„ç»‡çº§åˆ«çš„æ“ä½œ

## å®Œæ•´æƒé™é…ç½®ï¼ˆGitea 1.22.6 æ¨èï¼‰

å‹¾é€‰æ‰€æœ‰å¯ç”¨çš„æƒé™èŒƒå›´ï¼š

```
â˜‘ read:user
â˜‘ read:repository
â˜‘ read:organization
â˜‘ write:user
â˜‘ write:repository
â˜‘ write:organization
â˜‘ write:issue
â˜‘ write:admin
```

**æ³¨æ„**ï¼šGitea 1.22.6 ä¸­ä¸å­˜åœ¨ `read:api`ï¼Œæ‰€ä»¥ä¸Šè¿°åˆ—è¡¨å·²ç»æ˜¯å®Œæ•´çš„å¯ç”¨æƒé™ã€‚

## éªŒè¯æ¸…å•

åˆ›å»º Token åï¼Œæ£€æŸ¥ä»¥ä¸‹äº‹é¡¹ï¼š

- [ ] âœ… è®¿é—®äº† Token ç®¡ç†ç•Œé¢
- [ ] âœ… åˆ›å»ºäº†æ–° Token
- [ ] âœ… æƒé™åŒ…æ‹¬ `read:user`
- [ ] âœ… æƒé™åŒ…æ‹¬ `write:issue`
- [ ] âœ… å¤åˆ¶äº† Token å€¼
- [ ] âœ… æ›´æ–°äº†ç¯å¢ƒå˜é‡ï¼ˆæˆ– shell é…ç½®ï¼‰
- [ ] âœ… éªŒè¯ `echo $GITEA_ADMIN_TOKEN` è¾“å‡ºæ­£ç¡®
- [ ] âœ… è¿è¡Œäº† `test_token_permissions.sh` å¹¶çœ‹åˆ° âœ…

## æ•…éšœæ’é™¤

### é—®é¢˜ï¼šè¿è¡Œ test_token_permissions.sh è¿˜æ˜¯æ˜¾ç¤ºé”™è¯¯

**è§£å†³**ï¼š
1. ç¡®è®¤å½“å‰ shell ä¸­çš„ `GITEA_ADMIN_TOKEN` å·²æ›´æ–°
2. å¦‚æœå†™å…¥ shell é…ç½®ï¼Œè®°å¾— `source ~/.bashrc`ï¼ˆæˆ–å¯¹åº”æ–‡ä»¶ï¼‰
3. ç¡®è®¤ Token å·²æ­£ç¡®å¤åˆ¶ï¼ˆæ— ç©ºæ ¼ã€å®Œæ•´å€¼ï¼‰

### é—®é¢˜ï¼štest_token_permissions.sh æ˜¾ç¤º HTTP 404

**åŸå› **ï¼šæŸäº› API ç«¯ç‚¹åœ¨ä½ çš„ Gitea ç‰ˆæœ¬ä¸­å¯èƒ½ä¸å­˜åœ¨

**è§£å†³**ï¼šåªè¦ `read:user` æ˜¾ç¤º âœ…ï¼Œå°±è¯´æ˜åŸºç¡€æƒé™æ­£å¸¸

### é—®é¢˜ï¼šå¦‚ä½•æŸ¥çœ‹å·²åˆ›å»ºçš„ Token åˆ—è¡¨

åœ¨ Token ç®¡ç†ç•Œé¢ä¸­ï¼Œå¯ä»¥çœ‹åˆ°æ‰€æœ‰å·²åˆ›å»ºçš„ Token å’Œå®ƒä»¬çš„æƒé™èŒƒå›´ã€‚

### é—®é¢˜ï¼šå¦‚ä½•åˆ é™¤ Token

1. è®¿é—® Token ç®¡ç†ç•Œé¢
2. æ‰¾åˆ°è¦åˆ é™¤çš„ Token
3. ç‚¹å‡»åˆ é™¤æŒ‰é’®

## ç›¸å…³æ–‡ä»¶

- `scripts/test_token_permissions.sh` - Token æƒé™æµ‹è¯•è„šæœ¬
- `check_config.sh` - å®Œæ•´é…ç½®æ£€æŸ¥è„šæœ¬

## Gitea ç‰ˆæœ¬å…¼å®¹æ€§

ä¸åŒç‰ˆæœ¬çš„ Gitea å¯èƒ½æ”¯æŒä¸åŒçš„æƒé™èŒƒå›´ï¼š

### Gitea 1.22.6ï¼ˆå½“å‰ç‰ˆæœ¬ï¼‰
æ”¯æŒçš„æƒé™èŒƒå›´ï¼š
- read:user, read:repository, read:organization
- write:user, write:repository, write:organization, write:issue, write:admin

**ä¸æ”¯æŒ**ï¼šread:apiï¼ˆæ­¤æƒé™ä¸å­˜åœ¨ï¼‰

### å¦‚ä½•æ£€æŸ¥ä½ çš„ Gitea ç‰ˆæœ¬

è®¿é—®ï¼šhttp://49.234.193.192:3000/user/settings/applications/tokens

æŸ¥çœ‹æƒé™åˆ—è¡¨ï¼Œä¼šæ˜¾ç¤ºä½ çš„ Gitea ç‰ˆæœ¬æ”¯æŒçš„æ‰€æœ‰æƒé™èŒƒå›´ã€‚

## ç›¸å…³é“¾æ¥

- Gitea æœåŠ¡å™¨ï¼šhttp://49.234.193.192:3000
- Gitea API æ–‡æ¡£ï¼šhttp://49.234.193.192:3000/api/swagger
- Token ç®¡ç†é¡µé¢ï¼šhttp://49.234.193.192:3000/user/settings/applications/tokens

## æ€»ç»“

å…³é”®è¦ç‚¹ï¼š
1. **read:user æ˜¯å¿…éœ€çš„** - è¿™æ˜¯åŸºç¡€æƒé™
2. **write:issue å¯ç”¨äº PR è¯„è®º** - è‹¥éœ€è¦å‘å¸ƒäººå·¥é€šçŸ¥å¯å‹¾é€‰
3. **Token åˆ›å»ºåæ— æ³•ç¼–è¾‘** - å¦‚æœæƒé™é”™äº†ï¼Œå¿…é¡»åˆ é™¤å¹¶é‡æ–°åˆ›å»º
4. **ä½¿ç”¨ test_token_permissions.sh éªŒè¯** - ç¡®ä¿æƒé™æ­£ç¡®è®¾ç½®

